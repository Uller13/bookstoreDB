
# API для БД сети книжных магазинов

Данный API позволяет осуществить 4 указанных в описании задания методов:

* Получение информации о пользователе
* Просмотра истории заказов конкретного пользователя
* Размещения нового заказа
* Получение информации о доступном ассортименте магазина

## Установка


### Требования
В качестве СУБД выбран MySQL. Сервер можно получить по ссылке https://dev.mysql.com/downloads/mysql/
При разработке использовалась версия MySQL 8.0.18, а также MySQL Workbench.

Скрипты для инициализации БД находятся в папке sql scripts. Порядок выполнения:
* create database для создания самой БД.
* create tables для инициализации таблиц
* insertions для заполнения таблиц записями
* create user создаст пользователя, через которого программа app.py взаимодействует с MySQL сервером по умолчанию.

В requirements.txt содержатся все зависимости программы. 
Внимание! Модуль cryptography необходим для передачи пароля пользователя серверу MySQL. Для установки модуля необходимо наличие Microsoft C++ Build Tools. Найти их вы можете по ссылке https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2017. 



## Работа с программой

После запуска app.py вы увидите сообщение 

```
======== Running on http://0.0.0.0:8080 ========
(Press CTRL+C to quit)
```
После этого вы можете начать отправлять запросы программе.
Выходная информация каждого из GET запросов выводится в виде текстовой строки.
Сервер понимает 4 запроса:

### GET user 
Такой запрос возвращает информацию о выбранном пользователе.
Этот запрос имеет формат
```
/users/{id}
```
Запрос вернет строку следующего формата:
```
[({user_id}, {name}, {surname}, {patronym}, {email})]
```
Так, запрос 
```
/user/2
```
вернет

```
[(2, 'John', 'Doe', None, 'JDoe@gmail.com')]
```

### GET purchase history
Такой запрос возвращает информацию об истории покупок выбранного пользователя.
Это запрос формата
```
/history/{user_id}
```
Данный запрос вернет строку следующего формата:
```
[({orders.id}, {orders.reg_date}, {orderitems.book_id}, {orderitems.book_quantity}, {orderitems.shop_id})]
```
Так, запрос 
```
/history/2
```
вернет такую строку как:

```
[(2, datetime.datetime(2019, 11, 10, 21, 5, 37), 2, 1, 3), (5, datetime.datetime(2019, 11, 10, 21, 5, 37), 2, 2, 1), (5, datetime.datetime(2019, 11, 10, 21, 5, 37), 3, 1, 1)]
```
### GET shop stock
Это запрос формата
```
/stock/{shop_id}
```
Данный запрос вернет строку следующего формата:
```
[[{book1_id}, {book1_quantity})], [({book2_id}, {book2_quantity}] ... ]
```
Так, запрос 
```
/stock/2
```
вернет такую строку как:

```
[[1, 10], [2, 0], [3, 10]]
```
### POST new order
Этот запрос позволяет размещать новый заказ. Для выполнения требуется: параметр book_ids, обозначающий список книг, разделенных запятой, book_qs, обозначающий список количества книг, разделенных запятой, user_id, определяющий покупателя и shop_id, определяющий магазин.

Запрос
```
/neworder?book_ids=1,2&book_qs=2,2&user_id=3&shop_id=3
```
означает внесение в БД нового заказа, размещенного пользователем номер 3 в магазине номер 3 на книги номер 1 и 2 по 2 штуки каждая.
